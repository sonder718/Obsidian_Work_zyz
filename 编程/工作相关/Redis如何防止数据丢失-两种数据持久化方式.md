- Redis是一个**内存数据库**，它的数据都保存在内存中，如果**实例宕机，那么数据则全部丢失**。如何保证数据的完整性和安全性也是提高服务高可用的重要机制之一
# Redis提供的数据持久化方式
## RDB
- RDB全称Redis Database Backup file（Redis数据备份文件）,也被叫做Redis数据快照。
- 我们可以通过执行`save`或`bgsave`命令让Redis在本地生成RDB快照文件，这个RDB文件包含了**整个实例接近完整的数据内容**。
	- Redis提供了**定时**触发生成RDB文件的配置项
	- 从RDB文件恢复数据：**如果使用了RDB持久化机制，可以通过加载最近的RDB文件来恢复数据**。
- **适用场景**
	- 主从全量同步数据
	- 数据库备份
	- 对于丢失数据不敏感的业务场景，实例宕机后快速恢复数据
- **它的优点如下：**
	-   RDB文件数据是被压缩写入的，因此RDB文件的体积要比整个实例内存要小
	-   当实例宕机恢复时，加载RDB文件的速度很快，能够在很短时间内迅速恢复文件中的数据
- **它的缺点也很明显：**
	-   由于是某一时刻的数据快照，因此它的数据并不全
	-   生成RDB文件的代价是比较大的，它会消耗大量的CPU和内存资源
## AOF
- AOF全称为`Append Only File`（**追加日志文件**）。它与RDB不同的是，AOF中记录的是每一个**命令**的详细信息，包括完整的命令类型、参数等。**只要产生写命令，就会实时写入到AOF文件中**。
### 刷盘方式
- 开启AOF后，Redis会**把每个写操作的命令记录到文件并持久化到磁盘中**，为了保证数据文件的安全性，Redis还提供了文件刷盘的时机：
	-   `appendfsync always`：每次写入都刷盘，对性能影响最大，占用磁盘IO比较高，[数据安全](https://cloud.tencent.com/solution/data_protection?from=10680)性最高
	-   `appendfsync everysec`：1秒刷一次盘，对性能影响相对较小，节点宕机时最多丢失1秒的数据
	-   `appendfsync no`：按照操作系统的机制刷盘，对性能影响最小，数据安全性低，节点宕机丢失数据取决于操作系统刷盘机制