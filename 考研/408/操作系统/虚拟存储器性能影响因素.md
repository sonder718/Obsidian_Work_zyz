# 影响[虚拟存储器](../计算机组成原理/虚拟存储器.md)性能的主要因素
- **缺页率**:影响[虚拟存储器](../计算机组成原理/虚拟存储器.md)性能的主要因素
	- 潜在表现:CPU利用率低,磁盘交互区利用率高 #注意
- **影响缺页率的因素**
	- **页面大小**
		- 根据局部性原理,页面较大则缺页率较低,页面较小则缺页率较高。
		- 页面较小时,一方面减少了内存碎片,有利于提高内存利用率;另一方面,也会使每个进程要求较多的页面,导致页表过长,占用大量内存。页面较大时,虽然可以减少页表长度,但会使页内碎片增大。
	- **分配给进程的物理块数**(取决于工作集)
		- 分配给进程的物理块数越多,缺页率就越低,但是当物理块超过某个数目时,再为进程增加个物理块对缺页率的改善是不明显的。可见,此时已没有必要再为它分配更多的物理块,否则也只能是浪费内存空间。只要保证活跃页面在内存中,保持缺页率在一个很低的范围即可。
	- **[页面置换算法--OPT,FIFO,LRU,CLOCK](页面置换算法--OPT,FIFO,LRU,CLOCK.md)**
		- 好的页面置换算法可使进程在运行过程中具有较低的缺页率。选择LRU、CLOCK等置换算法,将未来有可能访问的页面尽量保留在内存中,从而提高页面的访问速度。
	- **写回磁盘的频率**
		- 换出已修改过的页面时,应当写回磁盘,如果每当一个页面被换出时就将它写回磁盘,那么每换出一个页面就需要启动一次磁盘,效率极低。
		- 为此在系统中建立一个**已修改换出页面的链表**,对每个要被换出的页面(已修改),可以暂不将它们写回磁盘,而将它们挂在该链表上,**仅当被换出页面数达到给定值时,才将它们一起写回磁盘**,这样就可显著减少磁盘I/O的次数,即减少已修改页面换出的开销。 #注意
		- 此外,如果有进程在这批数据还未写回磁盘时需要再次访问这些页面,就不需从外存调入,而**直接从已修改换出页面链表上获取**,这样也可以减少页面从磁盘读入内存的频率,减少页面换进的开销。 #注意
	- **程序的编制方法**
		- 编写程序的局部化程度越高,执行时的缺页率就越低。如果存储采用的是按行存储,访问时就要尽量采用相同的访问方式,避免按列访问造成缺页率过高的现象
	- #注意 磁盘交互区利用率高,增加磁盘交互区容量/速度**没有用**
- 页面缓冲算法（PBA） #疑问
<!--SR:!2022-10-15,3,250-->

# 工作集
## 什么是工作集
- 工作集（或驻留集）是指在**某段时间间隔内**，进程要访问的页面集合。
- #注意 可以用**最近访问过的页面**来确定工作集 #z408 
	- #注意 不重复
- ![](attachments/Pasted%20image%2020220927220006.png)
- 经常被使用的页面需要在工作集中，而**长期不被使用的页面要从工作集中被丢弃**。为了防止系统出现抖动现象，需要**选择合适的工作集大小**。

## 工作集模型的原理
-  让操作系统跟踪每个进程的工作集，并为**进程分配大于其工作集的物理块**。如果还有空闲物理块，则可以再调一个进程到内存以增加多道程序数。
-  如果所有工作集之和增加以至于**超过了可用物理块的总数**，那么操作系统会暂停一个进程，**将其页面调出并且将其物理块分配给其他进程**，防止出现抖动现象。
- 正确选择工作集的大小，对存储器的利用率和系统吞吐量的提嵩，都将产生重要影响

# 抖动
## 什么是抖动
-   抖动（Thrashing) 就是指当内存中已无空闲空间而又发生缺页中断时，需要从内存中调出一页程序或数据送磁盘的对换区中，如果算法不适当，**刚被换出的页很快被访问，需重新调入**，因此需再选一页调出，而此时被换出的页很快又要被访问，因而又需将它调入，如此频繁更换页面，使得系统把大部分时间用在了页面的调进换出上，而几乎不能完成任何有效的工作，我们称这种现象为"抖动"。
## 产生抖动的原因
- 产生抖动的原因是同时在系统中运行中的进程太多，由此**分配给每一个进程的物理块太少**，不能满足进程正常运行的基本要求，致使每个进程在运行时，频繁地出现缺页，必须请求系统将缺的页调入内存。处理机忙于页面置换，几乎不能进行有效工作。
- #注意 [页面置换算法--OPT,FIFO,LRU,CLOCK](页面置换算法--OPT,FIFO,LRU,CLOCK.md)不合理
## 抖动的预防
**题20.当前可以利用哪几种方法来防止“抖动”？**

-   采取局部置换策略 #疑问
-   把工作集算法融入到处理机调度中
-   利用“L=S”准则调节缺页率
-   选择暂停的进程

**题21.试试说明如何利用“L=S”准则来调节缺页率，以避免“抖动”的发生?**

-   答：P173 于1980年Denning提出了“L=S”的准则，来调节多道程序度，
-   其中L是缺页之间的平均时间，S是平均缺页服务时间，即用于置换一个页面所需的时间。 #疑问
-   利用“L=S”准则，对于调节缺页率是十分有效的。