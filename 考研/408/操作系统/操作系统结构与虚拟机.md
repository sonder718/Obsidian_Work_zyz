# 计算机系统的层次结构
- Ubuntu、CentOS 的开发团 队，其主要工作是实现非内核功能，而内核都是用 了 Linux 内核 #注意
![](attachments/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%202022-09-20%2017.46.54.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%202022-09-20%2017.46.54.excalidraw.md)%%
## 操作系统结构
![](attachments/Pasted%20image%2020220920175950.png)
- 分层结构
- 模块化
- 宏内核
- 微内核
- 外核
## 宏内核与微内核
![](attachments/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%202022-09-20%2017.51.19.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%202022-09-20%2017.51.19.excalidraw.md)%%
### 宏内核
- 单内核/大内核
- **特点**
	- 操作系统的主要功能部件都作为系统内核
	- 高性能
		- 变态的过程是有成本的，要消耗不少时间，频繁地变态会降低系统性能
	- 内核代码庞大
	- 内核中某个功能模块崩溃,可能导致整个系统崩溃
- **典型**
	- UNIX,Linux
### 微内核
- **特点**
	- 内核中只保留最基本的功能(**中断,原语,进程通信等**)
		- 进程管理,存储管理,设备管理等运行在用户态
		- 低级IO,低级进程管理与调度需要放入微内核 #注意
	- 高可靠性
		- 一个模块的错误只会使这个模块崩溃,不会使整个系统崩溃
	- 性能略低
		- 频繁在用户态和核心态间切换,执行开销大
	- **客户/服务器模式**
	- 机制与策略分离原理
		- 机制指实现某一功能的具体执行机构,放在微内核中
		- 策略在机制的基础上来实现优化或达到不同功能
	- 采用面向对象技术
- **结构划分**
	- 微内核
		- **基本功能**
			- 进程管理
			- 低级存储器管理
			- 中断和陷入处理
		- 客户与服务器间的通信
	- 微内核外的服务器(进程)
		- 操作系统的绝大多数功能
- **消息传递机制**
	- 运行在用户态,客户与服务器之间是借助微内核提供的信息传递机制进行交互
	- ![](attachments/Pasted%20image%2020220920181158.png)
- **典型**
	- 鸿蒙OS,Windows(NT)
	- 特定领域，主要是实时性和可靠性要求比较高的领域，如QNX，Integrity，VxWorks
	-  嵌入式领域，如FreeRTOS，ARTs-OS，L4
## 外核exokernel
- **任务**
	- 给虚拟机分配资源并检查这些资源的企图,以确保没有机器会使用他人的资源
		- 对机器进行分区,给每个用户**整个资源的一个子集**
	- ==保持多个虚拟机彼此不发生冲突==
- **特点**
	- 在内核态运行
	- 减少了映射层
		- 外核只需要记录已经分配给各个虚拟机的有关资源
	- 将多道程序(**在外核内**)与用户操作系统代码(**在用户空间内**)分离 #疑问

# 操作系统引导(Boot)
## 一些概念
#### 解决的核心问题
开机的时候怎么让操作系统运行起来
#### 是什么
计算机利用CPU运行特定程序,通过程序识别硬盘,识别**硬盘分区**,识别硬盘分区上的**操作系统**,最后通过程序启动操作系统
### 注意
- #注意 引导程序分为两种
	- 位于**ROM**的自举程序(**BIOS**的组成部分)
		- ROM寄存器中只存放很小的“自举装入程序”，开机时计算机先运行“自举装入程序”，通过执行该程序就可**找到引导块**，并将完整的“自举程序”读入内存，完成初始化。
		- 完整的自举程序放在**磁盘的启动块(即引导块/启动分区)** 上，启动块位于磁盘的固定位置，拥有启动分区的磁盘称为启动磁盘或 系统磁盘(C:盘)
	- 位于装有操作系统的**硬盘**的活动分区的引导扇区的引导程序(**启动管理器**),用于引导操作系统 #注意
## 操作系统引导的过程
- ①CPU从一个特定主存地址开始，取指令，执行ROM中的引导程序
	- **激活CPU**:激活的CPU读取**ROM中的boot程序**,将指令寄存器置为**BIOS(基本输入输出系统)** 的第一条指令
		- BIOS（Basic Input Output System 基本输入输出系统）的运行代码则早已被刷入集成在主板的ROM芯片中。
		- CPU从地址FFFF:0000H处（即复位向量）开始执行指令（CS的初始值为0FFFFH，IP的初始值为0000H），这是**一条跳转指令**，跳到BIOS的启动代码处并**启动BIOS**。
		- 跳转后**登记BIOS中断例程入口地址** #注意
	- **硬件自检**:检查硬件是否出现故障
- ②将磁盘的第一块——**主引导记录MBR** 读入内存，执行磁盘引导程序，扫描分区表
	- **加载带有操作系统的硬盘**:硬件自检完成后,BIOS开始读取Boot Sequence,把==控制权交给启动顺序排名第一位的存储设备==,CPU将该存储设备引导扇区的内容加载到内存
	- **加载主引导记录MBR**:硬盘以特定的标识符区区分引导硬盘和非引导硬盘,如果发现一个存储设备是不可引导盘,就检查下一个存储设备.
		- MBR的作用是告诉CPU**去硬盘的哪个主分区**去找操作系统
	- **扫描硬盘分区表,并加载硬盘分区**:MBR包括硬盘分区表,其以特定的标识符区分活动分区和非活动分区.==把控制权交个硬盘活动分区==
- ③从活动分区（又称主分区，即安装了操作系统的分区）读入分区引导记录，执行其中的程序
	- **加载分区引导记录PBR**:读取分区引导记录即活动分区的第一个扇区,其作用是寻找并激活分区根目录下用于引导操作系统的程序(**启动管理器**)
- ④从根目录下找到完整的操作系统初始化程序（即 启动管理器）并执行，完成“开机”的一系列动作
	- **加载启动管理器**:PBR搜索活动分区中的启动管理器并加载
	- ![](attachments/Pasted%20image%2020220920201302.png)
	- **加载操作系统**
		- #注意 常驻内存的只是操作系统内核,其他部分只有需要时才调入
![](attachments/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%202022-09-20%2019.50.23.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%202022-09-20%2019.50.23.excalidraw.md)%%

# 虚拟机
## 虚拟机的两种虚拟化方式
### 裸金属架构
- 该虚拟机管理系统如同一个操作系统,是**唯一**运行在最高特权级的程序
- 虚拟机作为用户态的一个进程运行,不允许执行敏感指令
- **虚拟内核态**
	- 虚拟机上的操作系统认为自己处于内核态,实际上不是
		- 虚拟机上的用户进程认为自己处于用户态,实际确实是
	- 当虚拟机操作系统执行一条特权指令,**会陷入虚拟机管理系统**
![](attachments/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%202022-09-20%2020.15.38.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%202022-09-20%2020.15.38.excalidraw.md)%%
### 寄居架构
- **宿主操作系统**
	- 运行在底层硬件上的操作系统
- **客户操作系统**
	- 运行在虚拟机管理系统上的操作系统
![](attachments/Pasted%20image%2020220920202126.png)