
##### 引进管程的原因
- 信号量机制存在的问题：编写程序困难、易出错
	- 写错PV操作会死锁
	- ![](attachments/%E7%AE%A1%E7%A8%8B%202022-09-23%2021.43.56.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E7%AE%A1%E7%A8%8B%202022-09-23%2021.43.56.excalidraw.md)%% #疑问 v(mutex)不会将其唤醒吗?

##### 什么是管程
- 1973年，Brinch Hansen 首次在程序设计语言 (Pascal)中引入了“管程”成分——一种高级同步机制
- #注意 即**封装了一个管理进程的类**
	- ![](attachments/Pasted%20image%2020220923215132.png)
- 管程是一种特殊的软件模块，有这些部分**组成**： 
	- 1. 局部于管程的共享数据结构说明； 
	- 2. 对该数据结构进行操作的一组过程(函数)；
	-  3. 对局部于管程的共享数据设置初始值的语句；
	-  4. 管程有一个名字。
- **管程的特征**
	- 1. 局部于管程的数据只能被局部于管程的过程所访问；
	-  2. 一个进程**只有通过调用管程内的过程**才能进入管程访问共享数据；
		- 各外部进程/线程只能通过管程提供的**特定"入口"** 才能访问共享数据, #注意
	-  3. 每次仅允许**一个进程**在管程内执行某个内部过程 #注意
##### 管程中的条件变量
- **条件变量**(condition variables). 
	- 概念上，一个条件变量就是一个==线程队列==(queue), **其中的线程正等待某个条件变为真**
- ![](attachments/Pasted%20image%2020221211202918.png)
- 当一个通知(signal)发给了一个有线程处于等待中的条件变量，则有至少两个线程将要占用该管程: **发出通知的线程与等待该通知的某个线程**. ==只能有一个线程占用该管程==，因此必须做出选择。
##### 管程下的signal和wait
- X是**条件变量**
- 管程模式下的 x.**signal** () 和信号量的 signal () 区别在于：
	- 信号量操作 signal () 会**影响信号量**的状态 ，
	- 管程下的 x.signal () 在 **x 不存在挂起进程**的情况下==没有任何影响==。 
	- 举例：进程 P 调用 x.signal () ，且存在悬挂进程 Q 与条件变量 x 关联。
- 管程的`wait`操作**一定**会使进程进入==阻塞==状态，而`P`操作则未必。 #注意 #z408 
