## 中断和异常
### 核心
- 为提高资源利用率,需要在程序未使用某种资源时,把他对那种资源的占有权释放,这一行为通过**中断**实现
- ==发生中断或异常时,运行用户态的CPU会立刻进入核心态==
### 中断(interruption)
- 又称**外中断**
- 指来自CPU执行指令**外部**的**事件**
- **特性**
	- 由==外部设备==触发,与当前执行指令==无关==的==异步事件== #注意
		- 异步事件:非阻塞模式，无需等待
		- 异步是彼此独立，在等待某事件的过程中，继续做自己的事
		- 操作系统中,线程是异步实现的一个方式。
	- 可以被允许,可以被禁止
	- 外部IO设备通过**特定的中断请求信号线**向CPU发出中断请求
	- CPU==每执行完一条指令就检测中断请求线==,如果检测的中断请求,进入中断响应周期 #注意
- **中断示例**
	- 🐱设备发出的**I/O结束中断**,表明设备的输入输出完成
	- 🐱**时钟中断**,表示一个固定的时间片已到,让处理器处理计时,启动定时运行的任务等 #注意 #z408 
		- 从本质上说，**时钟中断**只是一个周期性的信号，完全是硬件行为，该信号触发CPU去执行一个**中断服务程序**
	- 🐱IO设备发出的如打印机缺纸,键盘输入,或用户按ESC建,定时器计数时间到
	- #注意 主存故障属于==硬件中断==,不是外中断
- **不同层级的中断控制**
	- 数据通路中有相应的**异常检测**和**响应逻辑** #注意
	- 外设接口中有相应的**中断请求**和**控制逻辑**
	- 操作系统中有相应的**中断服务程序**
- **分类**1
	- **可屏蔽中断**(INTR)
	- **不可屏蔽中断**(NMI):通常是紧急的硬件事故,如电源掉电等
- **分类2**
	- 访管中断
	- 程序中断
	- 外部中断
	- 硬件故障中断

### 异常(Exception)
- 又称**内中断**
- 指来自CPU执行指令==内部==的**事件**
	- 🐱程序的非法操作码,地址越界,运算溢出,虚存地址缺页,0作除数
	- 🐱专门的**陷入指令**(**访管指令**,Trap指令)
	- 🐱访存时**缺页** #z408 
		- ❌不属于中断
		- [缺页中断-页面从外存调入内存的方式](../操作系统/缺页中断-页面从外存调入内存的方式.md)
	- #注意 cache缺失不属于异常或中断
- 特性
	- CPU**执行一条指令时**,CPU内部检测到,与正在执行的指令相关的**同步事件**
	- 异常不能被屏蔽
	- 同步事件:阻塞模式,顺序执行
- **分类**
	- **软件中断**
		- 故障(Fault):通常是由指令执行引起的异常,如运算溢出
		- 自陷(Trap):一种事先安排好的异常事件,**用于用户态下调用操作系统内核程序**,如条件陷阱指令
	- **硬件中断**
		- 终止(Abort):出现了使CPU无法继续执行的硬件故障,如存储器校验错

### 中断机制的原理
不同的中断信号，需要用不同的中断处理程序来处理。当CPU检测到中断信号后，会根据中断信号 的类型去查询**中断向量表**，以此来找到相应的中断处理程序在内存中的存放位置
![](attachments/Pasted%20image%2020220919220745.png)