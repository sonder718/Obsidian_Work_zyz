##### 内存中文件的系统结构
- ![](attachments/%E6%96%87%E4%BB%B6%E7%9A%84%E6%93%8D%E4%BD%9C-%E6%89%93%E5%BC%80%E4%B8%8E%E5%85%B3%E9%97%AD%202022-11-20%2022.06.20.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E6%96%87%E4%BB%B6%E7%9A%84%E6%93%8D%E4%BD%9C-%E6%89%93%E5%BC%80%E4%B8%8E%E5%85%B3%E9%97%AD%202022-11-20%2022.06.20.excalidraw.md), and the [dark exported image](attachments/%E6%96%87%E4%BB%B6%E7%9A%84%E6%93%8D%E4%BD%9C-%E6%89%93%E5%BC%80%E4%B8%8E%E5%85%B3%E9%97%AD%202022-11-20%2022.06.20.excalidraw.dark.svg)%%
- ![](attachments/Pasted%20image%2020221121185445.png)
##### 打开/关闭一个文件的过程
- 操作系统维护**打开文件表**
	- 包含所有打开文件的表
	- 整个系统只有==一张==**系统打开文件表** #408x 
		- 每个文件只有==一个表项==
	- **每个进程**有**用户打开文件表**
	- ![](attachments/Pasted%20image%2020221121184246.png)
- 通过==系统调用open==,显式打开
	- 调用open,根据文件名**搜索目录**得到该文件FCB的指针
	- 将指明文件的**属性**(FCB)从外存复制到==内存==的**打开文件表**
		- #注意 打开文件的主要工作是将指定文件的目录复制到内存指定区域,==而不是复制文件内容==
		- 文件指针
		- 文件打开计数
		- 文件磁盘位置
		- 访问权限
	- 返回表目编号(**索引**)给用户
		- UNIX称为**文件描述符**
		- Windows称为**文件句柄**
- 用户再次操作文件时,可以通过索引在打开文件表中查找文件信息
- 文件不再使用时,通过==系统调用close==关闭它
	- 进程关闭文件,会将文件的引用计数==count减去1==，当引用计数count变为0时,系统从打开文件表中删除条目 #注意
