## CSMA/CA
### 为什么需要
- CSMA/CD协议已成功应用于使用**有线连接**的局域网，但在无线局域网环境下，却不能简单地搬用CSMA/CD协议，**特别是碰撞检测部分**。主要有两个原因:
	- 1)接收信号的强度往往会远小于发送信号的强度，且在无线**介质上信号强度的动态变化范围很大**，因此若要实现碰撞检测，则硬件上的花费就会过大。
	- 2)在无线通信中，并非所有的站点都能够听见对方，即存在“**隐蔽站**”问题。#注意
- ![](attachments/Pasted%20image%2020221207232721.png)

### 关于CSMA/CA
- 802.11 标准定义了广泛应用于无线局域网的CSMA/CA协议，它对CSMA/CD协议进行了修改，把碰撞检测改为==碰撞避免== **(Collision Avoidance, CA)** 。
-  “碰撞避免”并不是指协议可以完全避免碰撞，而是指协议的设计要**尽量降低碰撞发生的概率**。
- 由于802.11无线局域网不使用碰撞检测，一旦站点开始发送一个帧，就会完全地发送该帧，但碰撞存在时仍然发送整个数据帧(尤其是长数据帧)会严重降低网络的效率，因此要采用碰撞避免技术降低碰撞的可能性。
- 由于无线信道的通信质量远不如有线信道，802.11 使用**链路层确认/重传(ARQ) 方案**，即站点每通过无线局域网发送完-一帧， 就要在==收到对方的确认帧后才能继续发送下一帧。==
- **帧间间隔**IFS 
	- 为了尽量避免碰撞，802.11 规定，所有的站完成发送后，必须再等待一段很短的时间 (继续监听)才能发送下一帧。这段时间称为**帧间间隔**(InterFrame Space, IFS)。 
	- 帧间间隔的长短取决于该站要发送的帧的类型。
- **802.11 的3种IFS** #注意
	- 1) **SIFS** (短IFS):**最短的IFS**,用来分隔属于一次对话的各帧，使用SIFS的帧类型有**ACK帧、CTS帧**、分片后的数据帧，以及所有回答AP探询的帧等。
	- 2) **PIFS** (点协调IFS):中等长度的IFS,在PCF操作中使用
	- 3)**DIFS**(分布式协调IFS):==最长的IFS==，用于**异步帧竞争访问的时延**。 #注意
		- 高优先级帧需要等待的时间较短
		- 任何一个站要发送数据帧时，不仅都==必须等待一个DIFS的间隔==，而且还要进入争用窗口，并计算随机退避时间以便再次重新试图接入到信道,再发送**RTS（Request To Send）预约信道** #z408  #注意
		-  <!--SR:!2022-10-15,3,250-->
	- ![](attachments/Pasted%20image%2020221207232745.png)

### CSMA/CA工作原理
- **隐蔽站问题**
	- 站A和B都在AP的覆盖范围内，但A和B相跑较远，彼此都听不见对方。当A和B检测到信道空闲时，都向AP发送数据，导致碰撞的发生，这就是隐蔽站问题。
	- ![](attachments/Pasted%20image%2020221008213140.png)
- ==发送端==发送数据前，先检测信道**是否空闲**。
	- **空闲**则发出**RTS**(request to send)，RTS包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息; #z408  #注意
		- 为了避免**隐蔽站问题**，802.11允许发送站对信道<mark style="background: #FF5582A6;">进行预约</mark>。源站要发送数据帧之前先广播一个很短的请求发送RTS (Request To Send)控制帧,该帧能被**其范围内包括AP在内的所有站点听到**。 #注意
	- **信道忙**则等待。
- ==接收端==收到RTS后，将响应**CTS** (clear to send)。
	- 若信道空闲，则AP广播一个**允许发送**CTS (Clear To Send)控制帧，它包括这次通信所需的持续时间(从RTS帧复制),**该帧也能被其范围内包括A和B在内的所有站点听到**。B和其他站听到CTS后，在CTS帧中指明的时间内将抑制发送
	- CTS帧有两个目的
		- ①给源站明确的发送许可;
		- ②指示其他站点在预约期内不要发送。
	- 使用RTS和CTS帧会使网络的通信效率有所下降，但这两种帧都很短，与数据帧相比开销不算大。相反，若不使用这种控制帧，一旦发生碰撞而导致数据帧重发，则浪费的时间更多。信道预约不是强制性规定，各站可以自己决定使用或不使用信道预约。**只有当数据帧长度超过某一数值时**，使用RTS和CTS帧才比较有利。
- ==发送端==收到CTS后，开始发送**数据帧**(同时**预约信道**:发送方告知其他站点自己要传多久数据)。
- ==接收端==收到**数据**帧后，将用CRC来检验数据是否正确，正确则响应ACK帧。
- ==发送方==收到**ACK**就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止(采用二进制指数退避算法来确定随机的推迟时间)。
	- CSMA/CA的退避算法和CSMA/CD的稍有不同。
	- 信道从忙态变为空闲态时，任何一个站要发送数据帧，不仅都要等待一个时间间隔，**而且要进入争用窗口，计算随机退避时间**以便再次试图接入信道，因此降低了碰撞发生的概率。
	- 当且仅当检测到信道空闲且这个数据帧是要发送的第一个数据帧时，才不使用退避算法。其他所有情况都必须使用退避算法，具体为:①在发送第一个帧前检测到信道忙;②每次重传;③每次成功发送后要发送下一帧。