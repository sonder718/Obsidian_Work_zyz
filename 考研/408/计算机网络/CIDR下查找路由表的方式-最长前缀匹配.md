# CIDR查找路由表的方式
## 什么是最长前缀匹配(最佳匹配)
- 使用CIDR时,路由表中的每个项目由“网络前缀”和“下一跳地址”组成。在查找路由表时可能会得到==不止一个匹配结果==。
- 此时,应当从匹配结果中选择==具有最长网络前缀==的路由
	- 因为网络前缀越长,其地址块就越小,因而**路由就越具体**。 #注意
## 两种特殊的路由
- 1)**主机路由**:对特定目的主机的IP地址专门指明一个路由,以方便===网络管理员控制和测试网络===。
	- 若特定主机的IP地址是a.b.c.d,则转发表中对应项的目的网络是a.b.c.d/32。
	- /32表示的子网掩码没有意义,但这个特殊的前缀可以用在转发表中。
- 2)**默认路由**:用特殊前缀0.0.0.0/0表示默认路由
	- 全0掩码和任何目的地址进行按位与运算,结果必然为全0,即必然和转发表中的0.0.0.0/0相匹配。
	- 只要目的网络是其他网络(==不在转发表中==),就一律选择默认路由。 #注意
## 网络层转发分组的过程
- 1)从收到的IP分组的首部提取目的主机的IP地址D(即**目的地址**)。
- 2)若查找到特定主机路由(目的地址为D),就按照这条路由的下一跳转发分组
	- 否则从转发表中的==下一条==(**即按前缀长度的顺序**)开始检查,执行步骤3)。
		- 为了更加有效地查找最长前缀匹配,通常将无分类编址的路由表存放在一种**层次式数据结构**中,然后自上而下地按层次进行查找。这里最常用的数据结构就是二叉线索。
- 3)将这一行的**子网掩码**与**目的地址**D进行==按位与==运算。 #注意
	- ![](attachments/Pasted%20image%2020221013004553.png)
	- 若运算结果与本行的前缀匹配,则查找结束,按照“下一跳”指出的进行处理(或者直接交付本网络上的目的主机,或通过指定接口发送到下一跳路由器)。
	- 否则,若转发表还有下一行,则对下一行进行检查,重新执行步骤3)。否则,执行步骤4)。
- 4)若转发表中有一个**默认路由**,则把分组传送给默认路由;
	- 否则,报告转发分组出错。