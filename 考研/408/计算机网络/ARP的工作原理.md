
- **前提**
	- 已经通过IP寻址,找到下一跳的IP地址
		- #注意 在没有NAT的情况下,通常源IP地址和目的IP地址==不变化==,而MAC地址**每经过一个路由器**都==不断变化== #z408 
- **ARP表**与**ARP高速缓存**
	- ==每台主机==都设有一个**ARP高速缓存**,用来存放本局域网上各主机和路由器的IP地址到MAC地址的映射表,称**ARP表**。 #注意
	- ![](attachments/Pasted%20image%2020221211205010.png)
	- 使用ARP来动态维护此ARP表。
- 主机A欲向**本局域网上**的某台主机B**发送IP数据报**时,先在其ARP高速缓存中查看有无主机B的IP地址。 #注意
	- 如果**有**,就可查出其对应的硬件地址,再将此硬件地址**写入MAC帧**,然后通过局域网将该==MAC帧==发往此硬件地址。
		- 数据在MAC帧中,与ARP请求分组和响应分组无关
	- 如果**没有**,那么就通过使用目的MAC地址为==FF-FF-FF-FF-FF-FF==的帧来封装并==广播==**ARP请求分组**(==广播发送==),使**同一个局域网**里的==所有主机==都收到此ARP请求。 #注意  #z408 
		- ![](attachments/Pasted%20image%2020221013232948.png)
		- ![](attachments/Pasted%20image%2020221213202746.png)
		- 硬件类型：指明了发送方想知道的硬件接口类型，以太网的值为 1。
		- 协议类型：表示要映射的协议地址类型。它的值为 0x0800，表示 IP 地址。
		- 操作类型：用来表示这个报文的类型，ARP 请求为 1，ARP 响应为 2，RARP 请求为 3，RARP 响应为 4。
- 主机B**收到该ARP请求**后,向主机A发出**ARP响应分组**(==单播发送==) #注意 #z408 
	- 分组中包含==主机B的IP与MAC地址的映射关系==
- 主机A**收到ARP响应分组**后就将此映射写入ARP缓存,然后按查询到的硬件地址发送MAC帧。
	- ![](attachments/Pasted%20image%2020221013232242.png)
- ARP由于“看到了”IP地址,所以它工作在==网络层==,而NAT路由器由于“看到了”端口,所以它工作在==传输层==

