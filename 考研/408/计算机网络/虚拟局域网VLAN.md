# Tips
## 划分VLAN的方式
- VLAN是为解决以太网的广播问题和安全性而提出的，**一个VLAN内部的广播和单播流量都不会转发到其他VLAN中**。即使是处在同一网段的两台计算机，如果不在同一VLAN中，它们各自的广播流也不会相互转发。
- 划分VLAN有助于控制流量、减少设备投资、简化网络管理、提高网络的安全性。由于VLAN隔离了广播风暴，也隔离了不同VLAN之间的通讯，
	- 因此，不同VLAN之间的通讯必须依靠==路由器==或者**三层交换机**来实现。 #注意 
- **四种划分方式** #注意
	- **根据端口的划分VLAN**
		- 根据端口划分VLAN是最常用的一种VLAN划分方法。根据端口划分VLAN优点是简单明了，管理也非常方便，缺点是维护相对繁琐。
	- **根据MAC地址划分VLAN**
		- 根据网卡的MAC地址可以将若干台计算机划分在同一个VLAN中。
	- **根据网络层划分VLAN**
		- 这种划分VLAN的方法是根据每个主机的网络层地址或协议类型划分，而不是根据路由划分。注：这种VLAN划分方式适合广域网，基本不用在局域网
	- **根据IP组播划分VLAN**
		- IP组播实际上也是一种VLAN的定义，即认为一个组播组就是一个VLAN。这种划分方法将VLAN扩大到了广域网，不适合局域网，因为企业网络的规模尚未达到如此大的规模。
# 什么是虚拟局域网
- 一个以太网是一个**广播域**，当一个以太网包含的计算机太多时，往往会导致:
	- 以太网中出现大量的**广播帧**，特别是经常使用的[地址解析协议ARP-IP地址映射到MAC地址](地址解析协议ARP-IP地址映射到MAC地址.md)和 [动态地址配置协议DHCP-动态分配IP地址](动态地址配置协议DHCP-动态分配IP地址.md)（第4章)。
	- 一个单位的不同部门共享一个局域网，对信息保密和安全不利。
	- 不能有效共享网络资源
- **虚拟局域网**
	- 通过虚拟局域网（Virtual LAN)，可以把一个较大的局域网<mark style="background: #FF5582A6;">分割</mark>成一些较小的与地理位置无关的逻**辑上的VLAN**，而**每个VLAN是一个较小的广播域。** #注意

# 虚拟局域网的802.1Q帧
- 802.3ac标准定义了支持VLAN 的以太网帧格式的扩展。它在以太网帧中插入**一个4字节的标识符**（插入在源地址字段和类型字段之间)，称为**VLAN标签**，用来指明发送该帧的计算机属于哪个虚拟局域网。插入 VLAN标签的帧称为**802.1Q帧**
	- 增加了4字节，因此以太网的最大帧长从原来的1518字节变为1522字节。
- ![](attachments/Pasted%20image%2020221009161444.png)
- VLAN标签的前两个字节置为0x8100，表示这是一个802.1(
帧。在 VLAN标签的后两个字节中，前4位没有用，后**12位是该VLAN的标识符VID**，它唯一标识了该802.1Q帧**属于哪个VLAN**。12位的VID可识别4096个不同的VLAN。插入 VID后，802.1Q帧的FCS必须重新计算。
## 怎么构成虚拟局域网
- ![](attachments/Pasted%20image%2020221009161649.png)
- 如图所示，交换机1连接了7台计算机，该局域网划分为两个虚拟局域网VLAN-10和VLAN-20
	- 这里的10和20就是802.1Q帧中的VID字段的值，由交换机管理员设定。
	- 各主机并不知道自己的 VID值（但交换机必须知道)，主机与交换机之间交互的都是标准以太网帧。
	- **一个VLAN的范围可以跨越不同的交换机**，前提是所用的交换机能够识别和处理VLAN。
- 交换机2连接了5台计算机，并与交换机1相连。交换机2中的2台计算机加入VLAN-10，另外3台加入VLAN-20。这两个VLAN虽然都跨越了两个交换机，但**各自都是一个广播域**。 #注意 
- 假定**A**向**B**发送帧
	- 交换机1根据帧首部的目的MAC地址，识别B属于本交换机管理的VLAN-10，因此就像在普通以太网中那样**直接转发帧**。 #注意
- 假定**A**向**E**发送帧
	- 交换机1必须把帧转发到交换机2，但在转发前，要**插入VLAN标签**，否则交换机2不知道应把帧转发给哪个VLAN.因此在交换机端口之间的链路上传送的帧是802.1Q帧。
	- 交换机⒉在向E转发帧之前，要**拿走已插入的VLAN标签**，因此E收到的帧是A发送的**标准以太网帧**,而不是802.1Q帧。 #注意
- 如果**A**向**C**发送帧
	- 这是在不同网络之间的通信，虽然A和C都连接到同一个交换机，但是它们**已经处在不同的网络中**（VLAN-10和 VLAN-20)，需要通过<mark style="background: #FF5582A6;">上层的路由器来解决</mark>,也可以在交换机中嵌入专用芯片来进行转发，这样就在交换机中实现了第3层的转发功能。 <!--SR:!2022-10-13,1,230-->

## 关于VLAN的广播域
[[关于VLAN的广播域]]
