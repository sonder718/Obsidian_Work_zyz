## 以太网的MAC帧(以太网帧)
### 干啥用的
- 每块网卡中的MAC地址也称**物理地址**;
	- **MAC地址**（**英语：Media Access Control Address）**，直译为**媒体存取控制位址**，也称为**局域网地址**（LAN Address），**MAC位址**，**以太网地址**（Ethernet Address）或**物理地址**（Physical Address），
	-  MAC地址长==6字节== #注意
		- 一般用由连字符(或冒号)分隔的12个十六进制数表示,如02-60-8c-e4-bl-21。高24位为厂商代码,低24位为厂商自行分配的网卡序列号。 
	- 严格来讲,局域网的“地址”应是每个站的“名字”或标识符。
- 由于总线上使用的是**广播通信**,因此网卡从网络上每收到一个MAC帧,首先要用硬件**检查MAC帧中的MAC地址**。 #注意
	- 如果是发往本站的帧,那么就收下
	- 否则丢弃
### 组成
- **以太网MAC帧**格式有两种标准: DIX Ethernet V2标准(即以太网V2标准)和IEEE 802.3标准。这里先介绍最常用的以太网V2的MAC帧格式
	- MAC帧 = 6字节源mac地址 + 6字节目标mac地址 + **2字节类型** + **4字节帧检验序列FCS** + 数据长度（==46==~1500字节） #注意
- ![](attachments/%E4%BB%A5%E5%A4%AA%E7%BD%91%202022-10-09%2001.54.37.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E4%BB%A5%E5%A4%AA%E7%BD%91%202022-10-09%2001.54.37.excalidraw.md)%%
- **前导码**:使接收端与发送端**时钟同步**。 ^m7n664
	- 在帧前面插入的**8字节**可再分为两个字段:
		- 第一个字段共7字节,是**前同步码**,用来快速实现MAC帧的比特同步;
		- 第二个字段是**帧开始定界符**,表示后面的信息就是MAC帧。 
			- #注意: MAC帧并**不需要帧结束符**,因为以太网在传送帧时,各帧之间必须有一定的间隙。
				- 因此,接收端只要找到帧开始定界符,其后面连续到达的比特流就都属于同一个MAC帧,所以图3.26只有帧开始定界符。
				- 但不要误以为以太网MAC帧不需要尾部,在数据链路层上,帧既要加首部,也要加尾部。
					- Mac帧的<mark style="background: #FF5582A6;">尾部</mark>是**帧检验序列**（**fcs**）长度为32b #注意
- **地址**:通常使用6字节(48bit)地址(MAC地址)。
- **类型**:2字节,指出数据域中携带的数据应交给哪个协议实体处理。 #注意
	- 以太网帧拆出后->IP数据报/ARP报文
	- 0x0800网际协议（**IP**）
		- [IPv4数据报的格式](IPv4数据报的格式.md)
	- 0x0806地址解析协议**ARP**
		- [[地址解析协议ARP-IP地址映射到MAC地址]]
	- 0x8035动态**DHCP** 
		- [动态地址配置协议DHCP-动态分配IP地址](动态地址配置协议DHCP-动态分配IP地址.md)
- **数据**: 46~1500字节,包含高层的协议消息。
	- 注意: 46和1500是怎么来的?首先,由CSMA/CD算法可知以太网帧的最短帧长为64B,而**MAC帧的首部和尾部的长度为18字节**,所以数据字段最短为===46==字节。其次,最大的1500字节是规定的 #注意
		- [CSMA-CD下最小帧长与争用期-防止发生碰撞但已经发完导致没法停止发送](CSMA-CD下最小帧长与争用期-防止发生碰撞但已经发完导致没法停止发送.md)
		- 所以长度段的最大值是1500,因此从1501到65535的值可用于**类型段标识符**。
	- **填充**: 0~46字节,当帧长太短时填充帧,使之达到64字节的最小长度。
		- 由于CSMA/CD算法的限制,以太网帧必须满足最小长度要求64字节,数据较少时必须加以填充(0~46字节)
- **校验码**(FCS): 4字节,校验范围从目的地址段到数据段的末尾,算法采用32位循环冗余码(CRC),不但需要检验MAC帧的数据部分,还要检验目的地址、源地址和类型字段,但不校验前导码。 <!--SR:!2022-10-15,3,250-->