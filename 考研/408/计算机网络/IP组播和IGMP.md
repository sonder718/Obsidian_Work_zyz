# 什么是IP组播
- 为了能够支持像视频点播和视频会议这样的多媒体应用,网络必须实施某种有效的组播机制。
- 人们所需要的组播机制是让源计算机==一次==发送的**单个**分组可以抵达用一个组地址标识的**若干**目标主机,并被它们正确接收。
- 组播一定仅应用于 ==UDP==,它对将报文同时送往多个接收者的应用来说非常重要。 #注意
	- 而 TCP 是一个面向连接的协议,它意味着分别运行于两台主机(由 IP 地址来确定)内的两个进程(由端口号来确定)之间存在一条连接,因此会一对一地发送。
- 组播需要路由器的支持才能实现,能够运行组播协议的路由器称为**组播路由器**。
# 为什么使用组播
- 有的应用程序要把==一个分组发送给多个目的地主机==。
- 不是让源主机给每个目的地主机都发送一个单独的分组,而是让源主机把单个分组**发送给一个组播地址**
	- 该组播地址标识**一组地址**。
	- 网络(如因特网)把这个分组的副本投递给该组中的每台主机。主机可以选择加入或离开一个组,因此==一台主机可以同时属于多个组。==
- 主机组播时仅发送==一份数据==,只有数据在传送路径==出现分岔时==才将分组==复制==后继续转发。
	- 对发送者而言,数据只需发送一次就可发送到所有接收者
	- ![](attachments/Pasted%20image%2020221014170111.png)
# 因特网中的 IP 组播
- 因特网中的 IP 组播也使用组播组的概念,每个组都有一个特别分配的地址,要给该组发送的计算机将使用这个地址作为分组的目标地址。
## IP组播地址
- IP 组播使用 D 类地址格式。
	- D 类地址的前四位是 1110,因此 D 类地址范围是 224.0.0.0~239.255.255.255。 #注意
	- 每个 D 类 IP 地址标志==一个组播组==。
## 组播数据报
- 组播数据报和一般的 IP 数据报的区别是
	- 前者使用D类IP地址作为目的地址,并且首部中的**协议字段值是 2,** 表明使用 IGMP。
- 组播数据报的**特点**
	- 1)组播数据报也是“尽最大努力交付”,不提供可靠交付。
	- 2)组播地址只能用于**目的地址**,而不能用于源地址。
	- 3)对组播数据报==不产生 ICMP 差错报文==。
		- 因此,若在 PING 命令后面键入组播地址,将永远不会收到响应。
	- 4) 并非所有的D类地址都可作为组播地址。
## IP组播的分类
- **只在本局域网上进行硬件组播**
- **在因特网的范围内进行组播**。
	- 在因特网上进行组播的最后阶段,还是要把组播数据报在局域网上用==硬件组播==交付给组播组的所有成员。
	- LANA 拥有的==以太网组播地址==的范围是从 01-00-5E-00-00-00到01-00-5E-7F-FF-FF。 #注意
		- 不难看出,在每个地址中,只有 23 位可用作组播。这只能和D类IP 地址中的 23 位有一一对应关系。
		- D类IP地址可供分配的有 28 位,可见在这 28 位中,前5位不能用来构成以太网的硬件地址
		- ![](attachments/Pasted%20image%2020221014170617.png)
	- 由于组播 IP 地址与以太网硬件地址的映射关系**不是唯一**的,因此收到组播数据报的主机,还要在 ==IP 层利用软件进行过滤==,把不是本主机要接收的数据报丢弃。
		- 🐱IP 组播地址 224.128.64.32(即 E0-**80**-40-20)和另一个 IP 组播地址 224.0.64.32(即E0-**00**-40-20)转换成以太网的硬件组播地址都是 01-00-5E-00-40-20。
			- 0+后23位->MAC的后24位 00-40-20
			- 前24位:01-00-5E

# IGMP协议 
- **因特网组管理协议**(Internet Group Management Protocol,IGMP)
	- 要使路由器知道组播组成员的信息
		- IGMP 并不是在因特网范围内对所有组播组成员进行管理的协议。
		- IGMP **不知道** IP 组播组包含的成员数,也**不知道**这些成员分布在哪些网络上。
		- IGMP 让连接到**本地局域网**上的**组播路由器**知道==本局域网上是否有主机参加或退出了某个组播组==。
	- 连接到局域网上的组播路由器还必须和因特网上的其他组播路由器**协同工作**,以便把组播数据报用==最小代价==传送给所有组成员,这就需要使用**组播路由选择协议**。
		- 组播路由选择实际上就是要找出以源主机为根结点的==组播转发树== #注意
			- 因此不会有环路
		- 其中每个分组在每条链路上只传送一次(即在组播转发树上的路由器不会收到重复的组播数据报)。不同的多播组对应于不同的多播转发树;同一个多播组,对不同的源点也会有不同的多播转发树。
		- 在许多由路由器互联的支持硬件多点传送的网络上实现因特网组播时,主要有三种路由算法:第一种是基于链路状态的路由选择;第二种是基于距离-向量的路由选择;第三种可以建立在任何路由器协议之上,因此称为**协议无关的组播(PIM)**。
- IGMP 应视为网际协议 IP 的一个组成部分,其工作可分为**两个阶段**。
	- 第一阶段:当某台主机加入新的组播组时,该主机应向组播组的组播地址发送一个 IGMP 报文,声明自己要成为该组的成员。本地的组播路由器收到 IGMP 报文后,将组成员关系转发给因特网上的其他组播路由器。
	- 第二阶段: 因为组成员关系是动态的, 本地组播路由器要周期性地探询本地局域网上的主机,以便知道这些主机是否仍继续是组的成员。只要对某个组有一台主机响应,那么组播路由器就认为这个组是活跃的。但一个组在经过几次的探询后仍然没有一台主机响应时,则不再将该组的成员关系转发给其他的组播路由器。
