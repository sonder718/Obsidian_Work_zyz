##### Tips
- 前两次都有SYN=1 
- 后两次都有ACK=1
- 对于一对**已经建立连接的套接字**,再次请求建立会==建立失败==
- ![](attachments/TCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%202022-11-09%2015.31.25.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/TCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%202022-11-09%2015.31.25.excalidraw.md), and the [dark exported image](attachments/TCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%202022-11-09%2015.31.25.excalidraw.dark.svg)%%
##### 第一次握手
- 客户机的TCP首先向服务器的TCP发送连接请求报文段。
- 这个特殊报文段的首部中的同步位**SYN置1**
- 同时选择一个**初始序号seq=x**. 
	- TCP规定, SYN报文段**不能携带数据**,但==要消耗掉一个序号== #d408 
		- 🐱 因此接收方(服务器端)的回复报文的ack=**x+1**
- 这时,TCP客户进程进入**SYN-SENT (同步已发送)状态**。
##### 第二次握手
- 第二步:**服务器**的TCP收到连接请求报文段后
	- 如同意建立连接,则
		- 向客户机发回确认
		- 并为该TCP连接**分配缓存和变量**。
			- #注意 因此服务器容易受到SYN洪泛攻击 [[DOS攻击-SYN洪泛攻击]]
- 在确认报文段中,把**SYN位和ACK位都置1**
- 确认号是ack=x+1,同时也为自己选择一个**初始序号seq=y**
	- 注意,确认报文段**不能携带数据**,但也==要消耗掉一个序号==。
		- 🐱因此接收方(客户端)的回复报文的ack=y+1
- 这时,TCP服务器进程进入**SYN-RCVD(同步收到)**状态。
##### 第三次握手
- 第三步:当**客户机**收到确认报文段后
	- 还要向服务器给出确认
	- 并为该TCP连接**分配缓存和变量**。
- 确认报文段的ACK位置1
- 确认号ack=y+1,序号seq=x+1
	- 该报文段**可以携带数据**,若不携带数据则==不消耗序号==。 #注意
	- 这时,TCP客户进程进入ESTABLISHED (已建立连接)状态。