#### 后退N帧协议的运行过程-调用,收到帧,收到ACK,超时事件
- **优点**
	- 因连续发送数据帧而提高了信道利用率
- **缺点**
	- 在重传时必须把**原来已经正确传送的数据帧重传**,使传送效率降低
- ![](attachments/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6,%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E4%B8%8E%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%202022-10-07%2015.20.12.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6,%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E4%B8%8E%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%202022-10-07%2015.20.12.excalidraw.md)%%
##### 运行过程
- **上层的调用**
	- 上层要发送数据时，发送方先检查**发送窗口是否已满**
	- 如果未满，则**产生一个帧并将其发送**;
	- 如果窗口已满，发送方只需将数据返回给上层，暗示上层窗口已满。上层等一会再发送。(实际实现中，发送方可以**缓存这些数据，窗口不满时再发送帧**)。
- **接收方收到帧并发送一个ACK**
	- 如果正确收到n号帧,并**且按序**,那么接收方为n帧发送一个ACK,并将该帧中的数据部分交付给上层。
	- 接收方无需缓存任何失序帧,只需要维护一个信息: expected_seq_num (**下一个按序接收的帧序号**)
- **发送方收到了一个ACK**
	- GBN协议中，对n号帧的确认采用==累积确认==的方式，标明接收方**已经收到n号帧**和<mark style="background: #FF5582A6;">它之前的全部帧</mark>。 #注意 #注意
	- ![](attachments/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6,%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E4%B8%8E%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%202022-10-07%2017.20.22.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6,%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E4%B8%8E%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%202022-10-07%2017.20.22.excalidraw.md)%% ^8b5tqw
- **超时事件**
	- 协议的名字为后退N帧/回退N帧，来源于出现丢失和时延过长帧时发送方的行为。就像在停等协议中一样，定时器将再次用于恢复数据帧或确认帧的丢失。
	- 如果出现超时，发送方重传==所有==**已发送但未被确认的帧**。 #注意
		- 在重传时必须把**原来已经正确传送的数据帧重传**,使传送效率降低 #注意