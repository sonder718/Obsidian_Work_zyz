##### 访问web服务器的过程
- 用户主机A请求(**已知公网IP**)的Web服务器
	- NAT路由器记录==内网端口==和IP,并分配随机==外网端口==和全球IP
- Web服务器向用户主机A**发回数据**
	- 根据NAT表中的==对应IP和端口==,**唯一确定内网主机** #z408 
##### NAT路由器的工作原理
- ①假设用户主机10.0.0.1(随机端口3345)向Web服务器128.119.40.186 (端口80)发送请求。
- ②NAT 路由器收到IP分组后,为该IP分组==生成一个新端口号==**5001**,将IP分组的源地址更改为138.76.29.7(即NAT **路由器的全球IP地址**),将源端口号更改为5001。NAT路由器在==NAT 转换表中增加一个表项==。 #注意
	- 普通路由器在转发IP数据报时,不改变其源IP地址和目的IP地址。
	- NAT路由器在转发IP数据报时,一定要更换其IP地址(==转换源IP地址或目的IP地址==)。 #注意 
	- 普通路由器仅工作在网络层,而NAT路由器转发数据报时需要**查看和转换传输层的端口号**。 #注意
- ③Web服务器并不知道刚抵达的IP分组已被NAT路由器进行了改装,更不知道用户的专用地址,它响应的IP分组的目的地址是**NAT 路由器的全球IP地址,** 目的端口号是**5001**。
- ④响应分组到达NAT路由器后,通过**NAT转换表**将IP分组的目的IP地址更改为10.0.0.1,将目的端口号更改为3345。
- ![](attachments/Pasted%20image%2020221013230249.png)