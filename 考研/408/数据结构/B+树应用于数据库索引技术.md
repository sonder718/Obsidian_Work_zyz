[数据库索引——B+树索引（为什么使用B+树作为MySql的索引结构，用什么好处？） - your_棒棒糖 - 博客园 (cnblogs.com)](https://www.cnblogs.com/Candycan/p/14810842.html)
##### 使用B-Tree（B+Tree)的原因
- 文件系统及数据库系统普遍采用B-/+Tree作为索引结构
- 索引本身也很大，不可能全部存储在内存中,索引往往以**索引文件**的形式存储的**磁盘**上。
- 索引查找过程中就要产生**磁盘I/O消耗**,索引的结构组织要尽量减少查找过程中磁盘I/O的存取次数.
- 需要一种**单个节点可以存储多个键值和数据的平衡树**
##### 数据库系统的磁盘预读原理
![](attachments/Pasted%20image%2020221105155230.png)
- 将==一个节点的大小设为等于一个页==，这样每个节点只需要一次I/O就可以完全载入 #注意
	- 一个节点可以有**多个键值对**
- 每次新建节点时，直接申请一个页的空间，这样就保证一个节点物理上也存储在一个页里，加之计算机存储分配都是按页对齐的，就实现了一个node只需一次I/O。
- B-Tree中一次检索最多需要h-1次I/O（根节点常驻内存）
##### 红黑树不适合的原因
- 红黑树这种结构，**h明显要深的多**。
- 由于逻辑上很近的节点（父子）物理上可能很远，无法利用局部性
##### MySQL的B-Tree索引
- MyISAM引擎使用B+Tree作为索引结构，叶节点的data域存放的是数据记录的地址。下图是MyISAM主键索引的原理图：
- 所有**实际需要的数据**都存放于 Tree 的 Leaf Node(**叶子节点**) ，而且到任何一个 Leaf Node 的最短路径的长度都是完全相同的
- ![](attachments/B+%E6%A0%91%E5%BA%94%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E6%8A%80%E6%9C%AF%202022-11-05%2015.34.03.excalidraw.svg)
%%[🖋 Edit in Excalidraw](attachments/B+%E6%A0%91%E5%BA%94%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E6%8A%80%E6%9C%AF%202022-11-05%2015.34.03.excalidraw.md), and the [dark exported image](attachments/B+%E6%A0%91%E5%BA%94%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E6%8A%80%E6%9C%AF%202022-11-05%2015.34.03.excalidraw.dark.svg)%%

##### 一个数据库查找示例
现在假设我们要查找 id>=18 并且 id<40 的用户数据。对应的 sql 语句为：
```
select * from user where id>=18 and id <40
```
其中 id 为主键
![](attachments/Pasted%20image%2020221105154928.png)
具体的查找过程如下：

①一般根节点都是常驻内存的，也就是说页 1 已经在内存中了，此时不需要到磁盘中读取数据，直接从内存中读取即可。

从**内存中读取到页 1**，要查找这个 id>=18 and id <40 或者范围值，我们首先需要找到 id=18 的键值。

从页 1 中我们可以**找到键值 18**，此时我们需要根据指针 p2(**地址**)，定位到**页 3**。

②要从页 3 中查找数据，我们就需要拿着 p2 指针去磁盘中进行**读取页 3**。

从磁盘中读取页 3 后将**页 3 放入内存**中，然后进行查找，我们可以**找到键值 18**，然后再拿到页 3 中的指针 p1，定位到页 8。

③同样的页 8 页不在内存中，我们需要再去磁盘中将页 8 读取到内存中。

将页 8 读取到内存中后。因为页中的数据是链表进行连接的，而且键值是按照顺序存放的，此时可以根据二分查找法定位到键值 18。

此时因为已经到数据页了，此时我们已经找到一条满足条件的数据了，就是键值 18 对应的数据。

因为是范围查找，而且此时所有的数据又都存在叶子节点，并且是有序排列的，那么我们就可以对页 8 中的键值依次进行遍历查找并匹配满足条件的数据。

我们可以一直找到键值为 22 的数据，然后页 8 中就没有数据了，此时我们需要拿着页 8 中的 p 指针去读取页 9 中的数据。

④因为页 9 不在内存中，就又会加载页 9 到内存中，并通过和页 8 中一样的方式进行数据的查找，直到将页 12 加载到内存中，发现 41 大于 40，此时不满足条件。那么查找到此终止。

最终我们找到满足条件的所有数据，总共 12 条记录：

(18,kl), (19,kl), (22,hj), (24,io), (25,vg) , (29,jk), (31,jk) , (33,rt) , (34,ty) , (35,yu) , (37,rt) , (39,rt) 。
