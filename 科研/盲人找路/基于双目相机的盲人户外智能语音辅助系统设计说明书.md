# 基于双目相机的盲人户外智能语音辅助系统设计说明书



## 引言

### 编写目的

从整体上描述基于双目相机的盲人户外智能语音辅助系统要实现的功能，给程序开发者提供一个详细的设计说明和各个模块、各种技术的解决方案,给系统使用者一个总体的功能概述，让用户能够对本系统有一个全面正确的认识。

### 背景

如今我国是世界上视障人士最多的国家，但国内的盲道等无障碍设施尚不完善,，并且现实中盲道既存在断头路等设计缺陷又被占用严重，视障人士难以通过盲道安全出行。虽然近年来科技不断高速发展,视障人士对出行的强烈需求却鲜有平价优质的科技产品来满足,协助视障人士出行成了大家关注的问题。

近年来，计算机视觉技术领域取得了长足的进展，在目标检测、语义分割等方向都有大量出彩的技术出现，同时计算机视觉技术的落地与应用也愈发重要。基于双目相机的盲人户外智能语音辅助系统为解决盲人户外出行问题提供了一种前沿而有效的解决方式。

通常视障人士出行所面临的主要问题在于户外环境复杂多变，仅依靠导盲杖只能判定身边较小范围内的障碍物与盲道，导盲杖无法协助其走上如盲道人行道等相对安全的区域，在偏离时同样难以协助其回到盲道上，同时利用导盲杖只能够发现距离很近的障碍物，且盲人难以自行规划出避障策略。这一切只能依靠盲人自身的摸索，视障人士需要时刻处于一种精神高度紧张的状态，才能勉强确保安全。

面对盲人户外出行的需求，常见的策略是盲人携带安装摄像头或其他探测器的设备，设备实时监控盲人所处的环境并进行预警，然而目前国内外针对视障人士的电子导盲设备大多尚不成熟,存在以下三个缺陷：1.造价昂贵 2.功能单一(如电子导盲杖仅可避障不能导航等) 3.无法得到感兴趣的区域或物体（如盲道障碍物等）的距离与角度。

本系统计划通过设置双目相机来获取深度信息与RGB信息，利用这两项信息结合语义分割，光流估计等计算机视觉技术能够实现盲道引导与偏离预警，障碍物检测与避障等功能。



### 说明书结构

本手册分为六章。

第一章为概述。

第二章介绍系统总体框架。

第三章到第六章详细介绍各个模块的实现方案。



### 读者对象

本手册介绍了基于双目相机的盲人户外智能语音辅助系统的概念与功能，借助本文档的说明，可以很好的进行基本模块的开发，可供软件设计师、项目主管及测试人员使用。

### 术语

**双目摄像机(stereo camera)**

双目摄像机有两个左右相邻且相互独立的摄像机，采用平行光轴的系统结构获取视频图像，左右两台摄像机的焦距及其他内部参数均相等，光轴平行，两摄像机成像区域在同一平面且与光轴垂直。

<u>待补充</u>



## 总体设计

### 系统概述

基于双目相机的盲人户外智能语音辅助系统是一款能够可视化环境检测结果并输出语音指引提示的盲人辅助系统，系统能够分割出盲道与人行道并能获取其角度、走向、距离， 检测出障碍物的尺寸、角度、距离。系统能够通过语音提示指引盲人走向盲道或人行道， 当盲人有走出盲道的趋势时能够进行预警与矫正， 对于盲人前方有障碍物时能进行局部路线规划帮助盲人躲避障碍物。

### 系统的总体框架

系统主要分为四个模块，分别是用户界面，盲道人行道检测与分割，盲道引导与偏移检测，障碍物感知与避障。

<u>各模块的功能（待补充）</u>

<u>程序运行流程（待补充）（流程图）</u>

### 运行环境

#### 硬件环境

处理器：1 GHz 或更快的32位或者64位处理器

内存：1GB及以上 

磁盘：8GB及以上 

外设：需要连接双目相机

#### 软件环境

操作系统：Ubuntu 12.04 ，Windows 7或更高版本的操作系统

开发环境：python3.8，pyqt5 5.15.6

## 用户界面设计说明

### 程序描述

用户界面主要用于显示双目相机的深度图像，RGB图像，感知信息可视化图像与提示信息的显示与语音提醒

### 功能

用户界面主要分为两个功能区域：

一是视频显示区域，用户界面设置三个图像的结果显示区域，分别用于深度图像，RGB图像，感知信息可视化图像。

二是提示信息显示区域，用户界面设置一个文本框用于显示提示信息，当提示信息更新时，同时语音播报提示。

### 用户界面结构

![image-20220516175510632](%E5%9F%BA%E4%BA%8E%E5%8F%8C%E7%9B%AE%E7%9B%B8%E6%9C%BA%E7%9A%84%E7%9B%B2%E4%BA%BA%E6%88%B7%E5%A4%96%E6%99%BA%E8%83%BD%E8%AF%AD%E9%9F%B3%E8%BE%85%E5%8A%A9%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E%E4%B9%A6.assets/image-20220516175510632.png)

### 用户界面API概述

API函数功能如表所示：

用户界面API函数一览

| 序号 | 函数名称       | 功能                             | 备注             |
| ---- | -------------- | -------------------------------- | ---------------- |
| 1    | open_camera    | 查找硬件，新建线程开启摄像头     | RealSense相机    |
| 2    | open_realsense | 创建视频流                       | 在此循环流中处理 |
| 3    | update_uiimg   | 发送信号更新界面图像             | 无               |
| 4    | process_images | 处理图像并返回图像信息与文字提示 | 无               |

### 用户界面模块API说明

**1.open_camera()**

功能：  查找硬件，新建线程开启摄像头

输入参数：无

返回值：无

**2.open_realsense()**

功能：  新线程中创建视频流

输入参数：无

返回值：无

**3.update_uiimg(depth_colormap,color_image,processed_image,text)**

功能：发送信号更新界面图像

输入参数：

depth_colormap:当前帧深度图

color_image：当前帧RGB图

processed_image：感知信息可视化后的图像‘

text：提示信息

返回值：无

**4.process_images(color_img,depth_image)**

功能：处理图像并返回图像信息与文字提示

输入参数：

color_img:当前帧RGB图

depth_image：当前帧原始深度信息矩阵

返回值：包含处理后图像与提示信息的元组(process_img, warning_text)

## 盲道人行道检测与分割模块设计说明

### 程序描述

盲道人行道检测与分割是系统的核心组成部分，本系统的核心宗旨是让盲人尽可能的走在安全的地方，而盲道与人行道作为相对更加安全的区域是我们所提倡前往的，因此对于盲道与人行道的感知不能够仅仅停留在检测的程度，还需要进行进一步的语义分割，提取延伸方向，与抽象化区域等工作，本模块所完成的便是这些工作。由于现实环境复杂多变，相机防抖的缺失，盲道种类繁多而传统图像处理方法依赖人工设计特征等原因， 而深度学习泛化能力较强，本系统利用深度学习技术进行语义分割的实现。

### 功能

本模块要实现的功能有：

1.输入对齐后的RGB图像信息与深度信息

2.对图像进行像素级的语义分割，分割出盲道与人行道

3.获取盲道与人行道的走向与区域轮廓

4.获取盲道与人行道起点与用户当前所处位置的角度与距离



### 模块输入

对齐后的RGB图像信息与深度信息



### 模块输出

1. 盲道与人行道的走向 
2. 盲道与人行道的可行走区域轮廓
3. 盲道起点与用户当前所处位置的角度与距离

### 性能

计算及显示的速度达到每秒5帧以上。

### 流程逻辑

盲道人行道检测与分割模块总体流程

![er1434](%E5%9F%BA%E4%BA%8E%E5%8F%8C%E7%9B%AE%E7%9B%B8%E6%9C%BA%E7%9A%84%E7%9B%B2%E4%BA%BA%E6%88%B7%E5%A4%96%E6%99%BA%E8%83%BD%E8%AF%AD%E9%9F%B3%E8%BE%85%E5%8A%A9%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E%E4%B9%A6.assets/er1434.png)

人行道信息获取流程详细模块

![sideways1624](%E5%9F%BA%E4%BA%8E%E5%8F%8C%E7%9B%AE%E7%9B%B8%E6%9C%BA%E7%9A%84%E7%9B%B2%E4%BA%BA%E6%88%B7%E5%A4%96%E6%99%BA%E8%83%BD%E8%AF%AD%E9%9F%B3%E8%BE%85%E5%8A%A9%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E%E4%B9%A6.assets/sideways1624-16526901562071.png)

### API概述

盲道人行道检测与分割的相关函数主要的功能是语义分割出盲道与人行道并抽象化处理出区域轮廓等特征

API函数功能如表所示：

盲道人行道检测与分割API函数一览

| 序号 | 函数名称              | 功能                                  | 备注                          |
| ---- | --------------------- | ------------------------------------- | ----------------------------- |
| 1    | predict               | 利用训练好的Bisenetv2模型进行语义分割 | 分割得到像素级别的类别判定    |
| 2    | visualize             | 可视化语义分割结果                    | 盲道，人行道，背景对应3种颜色 |
| 3    | process_sideways      | 获取人行道信息                        | 无                            |
| 4    | process_blind_road    | 获取盲道信息                          | 无                            |
| 5    | visualize_information | 可视化感知到的信息到原始图像上        | 绘制点，线，文字等            |

| 序号 | 函数名称              | 功能                                  | 备注                          |
| ---- | --------------------- | ------------------------------------- | ----------------------------- |
| 1    | predict               | 利用训练好的Bisenetv2模型进行语义分割 | 分割得到像素级别的类别判定    |
| 2    | visualize             | 可视化语义分割结果                    | 盲道，人行道，背景对应3种颜色 |
| 3    | process_sideways      | 获取人行道信息                        | 无                            |
| 4    | process_blind_road    | 获取盲道信息                          | 无                            |
| 5    | visualize_information | 可视化感知到的信息到原始图像上        | 绘制点，线，文字等            |

### 盲道人行道检测与分割模块API说明

**1.predict(img)** 

功能：利用训练好的Bisenetv2模型进行语义分割

输入参数：img:待预测的RGB图像

返回值：分割后包含像素级别的类别判定的图像

**2.visualize(image, result,weight)**

功能：可视化语义分割结果

输入参数：image：原始图像

result：预测结果图像

weight：两图像权重

返回值：融合后的图像

**3.process_sideways(im,depth,W,H,bw_width,bw_height)**

功能：获取人行道信息

输入参数：im：语义分割结果

depth：真实深度信息矩阵

W：图像宽度

H：图像高度

bw_width：人行道宽度阈值

bw_height：人行道长度阈值

返回值：包含人行道距离，角度，轮廓等信息的字典return_res

**4.process_blind_road(im,depth,W,H,bw_width,bw_height)**

功能：获取盲道信息

输入参数：im：语义分割结果

depth：真实深度信息矩阵

W：图像宽度

H：图像高度

bw_width：盲道宽度阈值

bw_height：盲道长度阈值

返回值：包含盲道距离，角度，轮廓等信息的字典return_res

**5.visualize_information(result_vis,perception_sideways，perception_blind)**

功能：可视化感知到的信息到原始图像上

输入参数：result_vis：可视化语义分割后的结果

perception_sideways：包含人行道距离，角度，轮廓等信息的字典

perception_blind：包含盲道距离，角度，轮廓等信息的字典

返回值：处理后的图像



## 盲道引导与偏移检测模块设计说明



## 障碍物感知与避障模块设计说明







